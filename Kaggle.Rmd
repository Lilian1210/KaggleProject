# Kaggle Project

#Question Globale :
#Business Goal 
#Quelles est l'impact de notre environement social (parent , oseille , education ) sur  les resultats  scolaires ? L'objectif est de mettre en avant l'impact du contexte familial sur les resultats scolaire . 


#Plan 

#analyse , description du data (mean , variance, fille garcon, etc )

#Blabla sur etude analyse de data,age fille , proportion fille garcon etc mais on ne rentre pas dans le details de ce 
#que l'on veut faire dans la seconde partie   

#choisis les collones voulues (R extraction ) 

#description des futures analyse (regresion lineaire , )




# 1 On va etudier si notre data base est conforme (jsp ce quil avait dit de faire ici avec la conformite de la database ).

Importation de la base de données et installation des package:

```{r}
student<- read.csv('student-mat.csv')
#install.packages("ggplot2")
#install.packages("dplyr")
#install.packages("party")
#install.packages("rsample")
library(rsample)
library(ggplot2)
library(dplyr)
library(party)
```


#On etudie l'age  des fille et des garcons dans la population totale .

```{r}
n_student = nrow(student) #nb d'etudiant

age= ggplot(aes(x=age), data=student)+
  geom_histogram(binwidth = 0.50, fill='darkred', color='black')+
  ggtitle("Age of students")
age
```
```{r}
print("l'age moyen des étudiants est : "); mean(student$age)
print("la variance de l'age des étudiants est : "); var(student$age)
print("la medianne de l'age des étudiants est : "); median(student$age)
```

#Les écoles:
```{r}
student %>% distinct(school)
```
Les élèves font partie de 2 écoles au portugal MS = Mousinho da Silveira et GP = Gabriel Pereira.

```{r}
print("proportion d'étudiant a : Mousinho da Silveira")
sum(student$school=="MS")/n_student
print("proportion d'étudiant a Gabriel Pereira : ")
sum(student$school=="GP")/n_student

```


#On etudie le nombre de filles et de garcons dans la population totale 

```{r}
gender= ggplot(data=student,aes(x=sex,fill=sex))+geom_bar()
gender
```
```{r}
print("proportion de fille : ");sum(student$sex=="F")/n_student
print("proportion de garçon : ");sum(student$sex=="M")/n_student
```

#On etudie la sante des étudinats 

```{r}
health= ggplot(data=student,aes(x=health,fill=sex))+geom_histogram(binwidth=0.5, fill='salmon')
health
```
```{r}
print("la santé moyenne des étudiants est : "); mean(student$health)
print("la variance de la santé des étudiants est : "); var(student$health)
print("la medianne de la santé des étudiants est : "); median(student$health)
print("Pourcentage d'étudiant en bonne santé");sum(student$health>=3)/n_student

```

#We can see that the majority of the students are in good health


```{r}
var(student$G1)
ages= ggplot(data=student,aes(x=age, fill=sex))+geom_histogram(binwidth=0.50)
ages
```


#A utiliser plutot dans la seconde partie en lien avec le contexte social 

```{r}
area= ggplot(student, aes(x=address)) +
    geom_bar(fill='orchid')
area 
```
Classification :
https://veroniquetremblay.github.io/analyse_de_donnees_et_apprentissage_statistique_en_R/arbres-et-forets-aleatoires.html

```{r}
student <- student %>% select(address,famsize,Pstatus,Medu,Fedu,Mjob,Fjob,reason,
                              guardian,traveltime,famsup,nursery,famrel,G1,G2,G3)
student <- student %>%mutate(mean_grade = (G1+G2+2*G3)/4)
student <- student %>%mutate(G1 = NULL,G2 = NULL,G3 = NULL,mean_grade = mean_grade >= 10)
student <- student %>% mutate_all(as.factor)
```

Séparation des données :

```{r}
split <- initial_split(student, prop = .7, strata = "mean_grade")
#echantillonnage stratifié -> même proba de oui et non dans chaque partie
train <- training(split)
test  <- testing(split)
```

Création de l'arbre :

```{r}
# Choisir les hyperparamètres
hp <- ctree_control(minsplit = 2, #L'effectif minimal pour séparer un noeud 
                     minbucket = 1, # L'effectif minimal dans chaque noeud terminal
                     maxdepth = 70, # Hauteur (profondeur) maximale de l'arbre
                    mincriterion = 0.05) # 1-p-valeur à partir de laquelle on souhaite cesser la croissance)

# Construire l'arbre
arbre_ctree <- ctree(mean_grade~., train,control = hp)
arbre_ctree
```

Prediction :

```{r}
hat_y <- predict(arbre_ctree, # Le modèle
                 test)
hat_y
```
```{r}
sum(hat_y == test$mean_grade)/nrow(test)
```

